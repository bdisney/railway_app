<h4><%= t('.title') %></h4>

<%= form_for(@search, method: :post, url: search_path) do |f| %>
    <%= render 'shared/errors_messages', resource: @search %>

    <div class="row">
        <div class="col-md-6">
            <%= f.label :start_station_id %>
            <%= f.collection_select :start_station_id, RailwayStation.all.ordered_by_title, :id, :title, {}, { class: "mdb-select colorful-select dropdown-warning" } %>
        </div>

        <div class="col-md-6">
            <%= f.label :end_station_id %>
            <%= f.collection_select :end_station_id, RailwayStation.all.ordered_by_title, :id, :title, {}, { class: "mdb-select colorful-select dropdown-warning" } %>
        </div>
    </div>

    <div class="actions">
        <%= submit_tag t('.submit') %>
    </div>
<% end %>

<% if @search.result %>
    <% if @search.result.empty? %>
        <p><%= t('.empty') %></p>
    <% else %>
        <table class="table text-center table-hover">
            <thead class="table-inverse text-center">
                <tr>
                    <th class="text-center"><%= t('tickets.attributes.train') %></th>
                    <th class="text-center"><%= t('tickets.attributes.route') %></th>
                    <th class="text-center"><%= t('tickets.attributes.departure_time') %></th>
                    <th class="text-center"><%= t('tickets.attributes.arrival_time') %></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <% @search.result.each do |train| %>
                    <tr>
                        <td><%= train.number %></td>
                        <td><%= train.route.name %></td>
                        <td><%= @search.start_station.within_route(train.route, :departure_time) %></td>
                        <td><%= @search.end_station.within_route(train.route, :arrival_time) %></td>
                        <td>
                            <%= form_tag(buy_tickets_path) do %>
                                <%= hidden_field_tag :train_id, train.id %>
                                <%= hidden_field_tag :start_station_id, @search.start_station_id %>
                                <%= hidden_field_tag :end_station_id, @search.end_station_id %>
                                <%= submit_tag t('.buy') %>
                            <% end %>
                        </td>
                    </tr>
                <% end %>
            </tbody>
        </table>
    <% end %>
<% end %> 